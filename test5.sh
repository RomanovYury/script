#!/bin/bash

# –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –≥—Ä—É–ø–ø

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
klist -s || { echo "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: kinit admin"; exit 1; }

echo "========================================="
echo "–°–ü–ò–°–û–ö –í–°–ï–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –° –ì–†–£–ü–ü–ê–ú–ò"
echo "========================================="

# –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å—Ä–∞–∑—É –≤—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
ipa user-find --all | grep "User login:" | awk '{print $3}' | while read user; do
    echo -e "\nüë§ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨: $user"
    echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"
    
    # –ü–æ–ª—É—á–∞–µ–º –≥—Ä—É–ø–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    groups=$(ipa user-show "$user" | grep "Member of groups:" | sed 's/Member of groups://' | tr ',' '\n' | sed 's/^[[:space:]]*//' | grep -v "^$")
    
    if [ -z "$groups" ]; then
        echo "   –ì—Ä—É–ø–ø—ã: –Ω–µ—Ç"
    else
        echo "$groups" | while read group; do
            echo "   üìÅ $group"
        done
    fi
done

echo -e "\n========================================="

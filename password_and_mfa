#!/bin/bash
 
# Куда сохранять отчет
if [ "$EUID" -ne 0 ]; then
    REPORT="$HOME/ald_security_policy_$(date +%F).txt"
else
    REPORT="/var/log/ald_security_policy_$(date +%F).txt"
fi
 
# Вывод в консоль + файл
exec > >(tee -a "$REPORT") 2>&1
 
echo "======================================"
echo "   SECURITY POLICY AUDIT"
echo "======================================"
echo "Дата: $(date)"
echo ""
 
############################################
echo "==== ПАРОЛЬНАЯ ПОЛИТИКА ===="
 
echo "-- Срок действия пароля --"
grep PASS_MAX_DAYS /etc/login.defs
grep PASS_MIN_DAYS /etc/login.defs
grep PASS_WARN_AGE /etc/login.defs
echo ""
 
echo "-- Сложность пароля (PAM) --"
grep pam_pwquality.so /etc/pam.d/common-password 2>/dev/null
grep pam_cracklib.so /etc/pam.d/common-password 2>/dev/null
echo ""
 
############################################
echo "==== ДВУХФАКТОРНАЯ АУТЕНТИФИКАЦИЯ (MFA) ===="
 
grep -E "pam_google_authenticator|pam_oath|pam_pkcs11" /etc/pam.d/* 2>/dev/null \
&& echo "MFA включена" \
|| echo "MFA не обнаружена"
 
echo ""
